# SQL 응용 과목 정리 내용


# 트랜잭션(:star::star::star)

## 1. 트랜잭션(Transaction)


### 1-1. 트랜잭션 개념
- **인가받지 않은 사용자로부터 데이터를 보장하기 위해 DBMS가 가져야 하는 특성**이자, 데이터베이스 시스템에서 **하나의 논리적 기능을 정상적으로 수행하기 위한 작업의 기본 단위**를 말함


### 1-2. 트랜잭션 특성

|특성|설명|주요기법|
|:---:|:---|:---:|
|<b>원자성</b>(Atomicity)|- 트랜잭션을 구성하는 연산 전체가 **모두 정상적으로 실행**되거나 **모두 취소**되어야 하는 성질|- Commit/Rollback<br>- 회복성 보장|
|<b>일관성</b>(Consistency)|- 시스템이 가지고 있는 고정요소는 **트랜잭션 수행 전과 트랜잭션 수행 완료 후의 상태가 같아야** 하는 성질|- 무결성 제약조건<br>- 동시성 제어|
|<b>격립성=고립성</b>(Isolation)|- 동시에 실행되는 트랜잭션들이 **서로 영향을 미치지 않아야 한다**는 성질|- Read Uncommitted<br>- Read Committed<br> - Repleatable Read<br>- Serializable|
|<b>영속성</b>(Durability)|- 성공이 완료된 트랜잭션의 결과는 **영송적으로 데이터베이스에 저장되어야 하는** 성질|- 회복기법|


### 1-3. 트랜잭션의 상태 변화

![image](https://user-images.githubusercontent.com/87363461/233035229-8718e213-2505-4b3b-a26f-ea88a26005bb.png)

#### 트랜잭션의 상태 설명

|상태|설명|
|:---:|:---|
|<b>활동 상태</b><br>(Active)|초기 상태, 트랜잭션이 실행 중일 때 가지는 상태|
|<b>부분 완료 상태</b><br>(Partialy Committed)|마지막 명령문이 실행된 후에 가지는 상태|
|<b>완료 상태</b><br>(Committed)|트랜잭션이 성공적으로 완료된 후 가지는 상태|
|<b>실패 상태</b><br>(Failed)|정상적인 실행이 더 이상 진행될 수 없을 때 가지는 상태|
|<b>철회 상태</b><br>(Aborted)|트랜잭션이 취소되고 데이터베이스가 트랜잭션 시작 전 상태로 환원된 상태|



### 1-4. 트랜잭션 제어
- 트랜잭션 제어언어는 TCL(Transaction Control Language)이라고 하며, **트랜잭션의 결과를 허용하거나 취소하는 목적으로 사용되는 언어**를 지칭함


#### TCL 명령어

|명령어||핵심|설명|
|:---:|:---:|:---|
|<b>커밋</b><br>(COMMIT)|트랜잭션 확정|트랜잭션을 메모리에 영구적으로 저장하는 명령어|
|<b>롤백</b><br>(ROLLBACK)|트랜잭션 취소|트랜잭션 내용을 저장 무효화시키는 명령어|
|<b>체크포인트</b><br>(CHECKPOINT)|저장 시기 설정|ROLLBACK을 위한 시점을 지정하는 명령어|



### 1-5. 병행 제어(Concurrency Control)(일관성 주요 기법)

#### 1. 병행 제어 개념
- 병행 제어는 **다수 사용자 환경에서 여러 트랜잭션을 수행할 때**, 데이터베이스 **일관성 유지를 위해 상호 작용을 제어하는 기법**임

#### 2. 병행 제어의 목적
- 데이터베이스의 공유를 최대화함
- 시스템의 활용도를 최대화함
- 데이터베이스의 일관성을 유지함
- 사용자에 대한 응답시간을 최소화함


#### 3. 병행 제어 미보장 시 문제점

|문제점|설명|
|:---:|:---|
|<b>갱신 손실</b><br>(Lost Update)|먼저 실행된 트랜잭션의 결과를 나중에 실행된 트랜잭션이 덮어쓸 때 발생하는 오류|
|<b>현황 파악오류</b><br>(Dirty Read)|트랜잭션의 중간 수행 결과를 다른 트랜잭션이 참조하여 발생하는 오류|
|<b>모순성</b><br>(Inconsistency)|두 트랜잭션이 동시에 실행되거나 데이터베이스의 일관성이 결여되는 오류|
|<b>연쇄 복귀</b><br>(Cascading<br>Rollback)|복수의 트랜잭션이 데이터 공유 시 특정 트랜잭션이 처리를 취소할 경우 트랜잭션이 처리한 곳의 부분을 취소하지 못하는 오류|


#### 4. 병행 제어 기법의 종류

- **로킹(Locking)**
  - **하나의 트랜잭션을 실행하는 동안** 특정 데이터 항목에 대해서 **다른 트랜잭션이 동시에 접근하지 못하도록 상호 배제(Mutual Exclusion) 기능을 제공**하는 기법
  - 로킹의 특징은 다음과 같음
    - 데이터베이스, 파일, 레코드 등은 로킹 단위가 될 수 있음
    - 로킹 단위가 작아지면 데이터베이스 공유도가 증가
    - 로킹 단위가 작아지면 로킹 오버헤드도 증가
    - 한꺼번에 로킹할 수 있는 객체의 크기를 로킹 단위라고 함

- **낙관적 검증(Optimistic Validation)**
  - 트랜잭션이 어떠한 검증도 수행하지 않고 **일단 트랜잭션을 수행하고** 트랜잭션 종료 시 **검증을 수행하여 데이터베이스에 반영하는 기법**
- **타임 스탬프 순서(Time Stamp Ordering)**
  - 트랜잭션과 트랜잭션이 읽거나 갱신한 데이터에 대해 트랜잭션이 실행을 시작하기 전에 타임 스탬프를 부여하여 부여된 시간에 따라 트랜잭션 작업을 수행하는 기법
- **다중버전 동시성 제어(MVCC, Multi Version Concurrency Control)**
  - 트랜잭션의 타임스탬프와 접근하려는 데이터의 타임스탬프를 비교하여 직렬가능성이 보장되는 적절한 버전을 선택하여 접근하도록 하는 기법


### 1-6. 데이터베이스 고립화 수준(격리성 주요 기법)

#### 1. 고립화 수준(Isolation Level) 개념
- 고립화 수준은 **다른 트랜잭션이 현재의 데이터에 대한 무결성을 해치지 않기 위해 잠금을 설정**하는 정도임

#### 2. 고립화 수준 종류

|수준|설명|
|:---:|:---|
|<b>Read Uncommitted</b>|- 한 트랜잭션에서 연산(갱신) 중인(아직 커밋되지 않은) 데이터를 다른 트랜잭션이 읽는 것을 허용하는 수준<br>- 연산(갱신) 중인 데이터에 대한 연산은 불허|
|<b>Read Committed</b>|- 한 트랜잭션에서 연산(갱신)을 수행할 때, 연산이 완료될 때까지 연산 대상 데이터에 대한 읽기를 제한하는 수준<br>- 연산이 완료되어 커밋된 데이터는 다른 트랜잭션이 읽는 것을 허용|
|<b>Repeatable Read</b>|- 선행 트랜잭션이 특정 데이터를 읽을 때, 트랜잭션 종료 시까지 해당 데이터에 대한 갱신 및 삭제를 제한하는 수준|
|<b>Serializable Read</b>|- 선행 트랜잭션이 특정 데이터 영역을 순차적으로 읽을 때, 해당 데이터 영역 전체에 대한 접근 제한하는 수준|

### 1-7. 회복 기법(영속성 주요 기법)


#### 1. 회복 기법(Recovery) 개념
- 회복 기법은 트랜잭션을 수행하는 도중 장애로 인해 손상된 데이터베이스를 손상되기 이전의 정상적인 상태로 복구시키는 작업임

#### 2. 회복 기법 종류

- 데이터베이스 회복을 위한 주요 요소로 REDO, UNDO가 있음

|구분|설명|
|:---:|:---|
|<b>REDO</b>|- 데이터베이스가 비정상적으로 종료되었을 때 디스크에 저장된 로그를 분석하여 트랜잭션의 시작(Start)과 완료(Commit)에 대한 기록이 있는 트랜잭션들의 작업을 재작업하는 기법<br>- 데이터베이스 내용 자체가 손상된 경우, 가장 최근의 복제본을 적재한 후 이후 일어난 변경만을 로그를 이용하여 재실행함으로써 데이터베이스를 복원하는 기법|
|<b>UNDO</b>|- 데이터베이스가 비정상적으로 종료되었을 때 디스크에 저장된 로그를 분석하여 트랜잭션의 시작(Start)은 있지만, 완료(Commit) 기록이 없는 트랜잭션들이 작업한 변경 내용들을 모두 취소하는 기법<br>- 데이터베이스 내용 자체는 손상되지 않았지만, 변경 중이거나 변경된 내용에 대한 신뢰성을 잃어버린 경우, 모든 변경 내용을 취소하여 복원하는 기법|


- 회복 기법 종류로 로그 기반 회복 기법, 체크 포인트 회복 기법, 그림자 페이징 회복 기법이 있음


#### 회복 기법 종류

|기법|설명|
|:---:|:---|
|<b>로그 기반<br>회복 기법</b>|- 지연 갱신 회복 기법과 즉각 갱신 회복 기법이 있음<br>- 지연 갱신 회복 기법 : 트랜잭션이 완료되기 전까지 데이터베이스에 기록하지 않는 기법<br>- 즉각 갱신 회복 기법 : 트랜잭션 수행 중 갱신 결과를 바로 DB에 반영하는 기법|
|<b>체크 포인트<br>회복 기법</b><br>(Checkpoint<br>Recovery)|- 장애 발생 시 검사점 이후에 처리된 트랜잭션에 대해서만 장애 발생 이전의 상태로 복원시키는 회복 기법|
|<b>그림자 페이징<br>회복 기법</b><br>(Shadow Paging<br>Recovery)|- 데이터베이스 트랜잭션 수행 시 복제본을 생성하여 데이터베이스 장애 시 이를 이용해 복구하는 기법|


## 2. DDL(Data Definition Language)

### 1. 데이터 정의어(DDL)의 개념

- 데이터 정의어는 데이터를 정의하는 언어로서 '**데이터를 담는 그릇을 정의하는 언어**'이다.
- 테이블과 같은 데이터 구조를 정의하는 데 사용되는 명령어들로 **특정 구조를 생성, 변경, 삭제, 이름을 바꾸는 데이터 구조와 관련된 명령어들을 데이터 정의어**라고 부름

### 2. DDL의 대상

- **도메인(Domain)**
  - 하나의 속성이 가질 수 있는 원자값들이 집합
  - 속성의 데이터 타입과 크기, 제약조건 등의 정보
- **스키마(Schema)**
  - 데이터베이스의 구조, 제약조건 등의 정보를 담고 있는 기본적인 구조
  - 스키마는 외부/개념/내부 3계층으로 구성되어 있음
  - **외부 스키마(External Schema)**
    - 사용자나 개발자의 관점에서 필요로 하는 데이터베이스의 논리적 구조
    - **사용자 뷰**를 나타냄
    - 서브 스키마로 불림
  - **개념 스키마(Conceptual Schema)**
    - 데이터베이스의 전체적인 논리적 구조
    - **전체적인 뷰**를 나타냄
    - 개체 간의 관계, 제약조건, 접근 권한, 무결성, 보안에 대해 정의
  - **내부 스키마(Internal Schema)**
    - 물리적 저장 장치의 관점에서 보는 데이터베이스 구조
    - 실제로 데이터베이스에 저장될 레코드의 형식을 정의하고 저장 데이터 항목의 표현 방법, 내부 레코드의 물리적 순서 등을 표현
- **테이블(Table)**
  - 데이터 저장 공간
- **뷰(View)**
  - 하나 이상의 물리 테이블에서 유도되는 가상의 테이블
- **인덱스(Index)**
  - 검색을 빠르게 하기 위한 데이터 구조






